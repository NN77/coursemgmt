<!DOCTYPE html>
<html lang="en" >
  <head>
    <title>Course Management App</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="A simple SPA app consuming a REST API built with AngularJS, Material Design, PostCss, Jade, Gulp, JSLint">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />

    <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Roboto:400,500,700,400italic'>
    <link rel="stylesheet" href="../node_modules/angular-material/angular-material.css"/>
    <link rel="stylesheet" href="app.css"/>

    <style type="text/css">
        [ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak {
          display: none !important;
        }
    </style>

  </head>

  <body ng-app="coursemgmtApp" layout="column" ng-controller="AppController as ac" ng-cloak>

    <md-toolbar layout="row">
      <md-button class="menu" hide-gt-sm ng-click="ac.toggleList()" aria-label="Show User List">
        <md-icon md-svg-icon="menu" ></md-icon>
      </md-button>
      <h1>Course Management App</h1>
    </md-toolbar>

    <div flex layout="row">
        <md-sidenav ng-click="ac.toggleList()" md-is-locked-open="$mdMedia('gt-sm')" md-component-id="left" class="md-whiteframe-z2" >
          <md-list ng-controller="CourseController as cl">
            <md-subheader>Courses</md-subheader>
            <md-list-item ng-repeat="gt in cl.courses">
                <md-button ng-click="cl.selectCourse(gt)" ng-class="{'selected' : gt === cl.selected && ac.courseCard }" aria-label="{{gt.title}}">
                  {{gt.title}}
                </md-button>
            </md-list-item>
          </md-list>
          <md-button  ng-click="ac.createCourse()" class="md-raised md-warn">Create Course</md-button>
          <md-list ng-controller="UserController as ul">
            <md-subheader>Users</md-subheader>
            <md-list-item ng-repeat="it in ul.users">
                <md-button ng-click="ul.selectUser(it)" ng-class="{'selected' : it === ul.selected  && ac.userCard }" aria-label="{{it.first_name}} {{it.last_name}}">
                  <md-icon md-svg-icon="{{it.avatar}}" class="avatar"></md-icon>
                  {{it.first_name}} {{it.last_name}}
                </md-button>
            </md-list-item>
          </md-list>
          <md-button  ng-click="ac.createUser()" class="md-raised md-accent">Create User</md-button>
        </md-sidenav>

        <md-content id="content" flex>
          <md-card ng-if="ac.courseCard">
            <md-card-title>
              <md-card-title-text>
                <span class="md-headline">{{ac.selected.title}}</span>
                <span class="md-subhead">begin: {{ac.selected.begin | date : format : timezone}}</span>
                <span class="md-subhead">end: {{ac.selected.end | date : format : timezone}}</span>
              </md-card-title-text>
            </md-card-title>
            <md-card-content layout="row" layout-align="space-between">
              <md-list class="md-dense" flex>
                <md-subheader class="md-no-sticky">Candidates</md-subheader>
                <md-list-item class="md-3-line" ng-repeat="c in ac.selected.candidates">
                  <md-icon md-svg-icon="{{c.avatar}}" class="avatar"></md-icon>
                  <div class="md-list-item-text" layout="column">
                    <h3>{{c.first_name}} {{c.last_name}}</h3>
                    <h4>id: {{c.id }}</h4>
                    <p>gender: {{c.gender}}</p>
                  </div>
                </md-list-item>
              </md-list>
              <md-card-actions layout="column">
                <md-button ng-click="ac.editCourseUsers(ac.selected)" class="md-icon-button" aria-label="Edit Users">
                  <md-icon md-svg-icon="assets/svg/edit.svg"></md-icon>
                  <md-tooltip md-direction="left">Edit Users</md-tooltip>
                </md-button>
                <md-button class="md-icon-button" aria-label="Add User">
                  <md-icon md-svg-icon="assets/svg/plus.svg"></md-icon>
                  <md-tooltip md-direction="left">Add User</md-tooltip>
                </md-button>
              </md-card-actions>
            </md-card-content>
          </md-card>
          <md-card ng-if="ac.userCard">
            <md-card-title>
              <md-card-title-text>
                <span class="md-headline">{{ac.selected.first_name}} {{ac.selected.last_name}}</span>
                <span class="md-subhead">gender: {{ac.selected.gender}}</span>
              </md-card-title-text>
              <md-card-title-media>
                <md-icon md-svg-icon="{{ac.selected.avatar}}" class="avatar"></md-icon>
              </md-card-title-media>
            </md-card-title>
            <md-card-actions layout="row" layout-align="end center">
              <md-button ng-click="ac.updateUser(ac.selected)">Edit User</md-button>
              <md-button>Delete User</md-button>
            </md-card-actions>
          </md-card>
        </md-content>

    </div>

    <script src="../node_modules/angular/angular.js"></script>
    <script src="../node_modules/angular-animate/angular-animate.js"></script>
    <script src="../node_modules/angular-aria/angular-aria.js"></script>
    <script type="text/javascript" src="../node_modules/angular-material/angular-material.js"></script>
    <script src="../node_modules/moment/moment.js"></script>

    <script src="./src/courses/Courses.js"></script>
    <script src="./src/courses/CourseController.js"></script>
    <script src="./src/courses/CourseService.js"></script>

    <script src="./src/users/Users.js"></script>
    <script src="./src/users/UserController.js"></script>
    <script src="./src/users/UserService.js"></script>

    <script type="text/javascript">

          angular
              .module('coursemgmtApp', ['ngMaterial', 'courses', 'users'])
              .config(function($mdThemingProvider, $mdIconProvider, $mdDateLocaleProvider){

                  $mdIconProvider
                      .defaultIconSet("./assets/svg/avatars.svg", 128)
                      .icon("menu"       , "./assets/svg/menu.svg"        , 24)
                      .icon("mail"       , "./assets/svg/mail.svg"        , 24)
                      .icon("share"      , "./assets/svg/share.svg"       , 24)
                      .icon("google_plus", "./assets/svg/google_plus.svg" , 512)
                      .icon("hangouts"   , "./assets/svg/hangouts.svg"    , 512)
                      .icon("twitter"    , "./assets/svg/twitter.svg"     , 512)
                      .icon("phone"      , "./assets/svg/phone.svg"       , 512);

                      $mdThemingProvider.theme('default')
                          .primaryPalette('blue-grey')
                          .accentPalette('red');
                          $mdDateLocaleProvider.formatDate = function(date) {
                            return date ? moment(date).format('DD-MM-YYYY') : '';
                          };

              })
              .controller('AppController', [
                 'userService', '$rootScope', '$mdSidenav', '$mdBottomSheet', '$timeout', '$log',
                 AppController
              ]);

              function AppController( userService, $rootScope, $mdSidenav, $mdBottomSheet, $timeout, $log ) {
                var self = this;

                self.selected         = null;
                self.toggleList       = toggleList;
                self.courseCard       = true;
                self.userCard         = false;
                self.updateUser       = updateUser;
                self.createUser       = createUser;
                self.editCourseUsers  = editCourseUsers;
                self.createCourse       = createCourse;

                $rootScope.$on('courses', function(event, courses) {
                  self.selected = courses;
                  self.courseCard = true;
                  self.userCard = false;
                });

                $rootScope.$on('users', function(event, users) {
                  self.selected = users;
                  self.courseCard = false;
                  self.userCard = true;
                });

                function toggleList() {
                  $mdSidenav('left').toggle();
                }

                function editCourseUsers(selectedCourse) {
                  $rootScope.$broadcast('editCourseUsers', selectedCourse);
                }

                function updateUser(selectedUser) {
                  $rootScope.$broadcast('updateUser', selectedUser);
                }

                function createUser(selectedUser) {
                  $rootScope.$broadcast('createUser', selectedUser);
                }

                function createCourse(selectedCourse) {
                  $rootScope.$broadcast('createCourse', selectedCourse);
                }
              }
    </script>

  </body>
</html>
